"""常量和映射定义"""
from typing import Dict, List, Set

# PSR类型到设备类型的转换
PSR_TYPE_TO_DEVICE_TYPE: Dict[str, str] = {
    "0101": "导线",
    "0337": "电缆",
    "0201": "电缆段",
    "0202": "电缆终端",
    "0203": "电缆接头",
    "0103": "杆塔",
    "0103005": "金具",
    "0103002": "金具",
    "0103001": "金具",
    "0306": "开关",
    "0113": "开关",
    "0307": "开关",
    "0112": "开关",
    "0305": "开关",
    "0111": "开关",
    "0110": "变压器",
    "0302": "变压器",
    "0123": "变压器",
    "0322": "站房",
    "zf04": "站房",
    "zf06": "站房",
    "zf07": "站房",
    "0204": "站房",
    "zf09": "站房",
    "0336": "站内电缆",
    "xndl": "电缆"
}

# 设备所属类型映射
DEVICE_AFFILIATED_MAP: Dict[str, str] = {
    "0101": "0103",
    "0306": "0322",
    "0307": "0322",
    "0305": "0322",
    "0302": "0322",
    "0318": "0322",
    "0322": "0322",
    "zf04": "0322",
    "zf06": "0322",
    "zf07": "0322",
    "0103": "0103",
    "0103005": "0103",
    "0103002": "0103",
    "0103001": "0103",
    "0112": "0103",
    "0113": "0103",
    "0111": "0103",
    "0110": "0103",
    "0123": "0103",
    "0201": "0201",
    "0204": "0322",
    "zf09": "0322",
    "0337": "0322",
    "0336": "0322",
    "0202": "0201",
    "0203": "0201",
    "xndl": "xndl"
}

# 设备所属字段映射
DEVICE_AFFILIATED_FIELD_MAP: Dict[str, str] = {
    "0101": "start_pole",
    "0103": "psr_id",
    "0103005": "astPole",
    "0103002": "pole",
    "0103001": "pole",
    "0306": "station",
    "0113": "pole",
    "0307": "station",
    "0112": "pole",
    "0305": "station",
    "0111": "pole",
    "0110": "pole",
    "0302": "station",
    "0123": "pole",
    "0318": "station",
    "0322": "psr_id",
    "zf04": "psr_id",
    "zf06": "psr_id",
    "zf07": "psr_id",
    "0201": "psr_id",
    "0204": "psr_id",
    "zf09": "psr_id",
    "0337": "station",
    "0336": "station",
    "0202": "start_position",
    "0203": "start_position",
    "xndl": "psr_id"
}

# 风险比例阈值
RISK_RATIO_LOW: float = 0.1
RISK_RATIO_MEDIUM: float = 0.3

# 设备类别代码映射
CONDUCTOR_CODE: Set[str] = {"0101"}  # 导线相关类型
CONDUCTOR_CODES: Set[str] = CONDUCTOR_CODE  # 兼容现有代码

CABLE_CODE: Set[str] = {"0201", "0337", "0336", "0202", "0203", "xndl"}  # 电缆相关类型

TOWER_CODE: Set[str] = {"0103"}  # 杆塔

HARDWARE_CODE: Set[str] = {"0103005", "0103002", "0103001"}  # 金具相关类型
HARDWARE_CODES: Set[str] = HARDWARE_CODE  # 兼容现有代码

SWITCH_CODE: Set[str] = {"0306", "0113", "0307", "0112", "0305", "0111"}  # 开关相关类型
SWITCH_CODES: Set[str] = SWITCH_CODE  # 兼容现有代码

TRANSFORMER_CODE: Set[str] = {"0110", "0302", "0123"}  # 配变

BILEIQI_CODE: Set[str] = {"0318"}  # 避雷器

STATION_CODE: Set[str] = {"0322", "zf04", "zf07", "zf06", "0204", "zf09"}  # 站房

# 天气故障风险描述
WEATHER_FAULT_RISKS: Dict[str, List[str]] = {
    "冰雪": [
        "导线/电缆：覆冰过载导致弧垂增大、拉伸甚至断线；不均匀脱冰引发导线舞动，造成相间短路。",
        "杆塔：荷载过大导致倾斜或倒塌；基础冻胀。",
        "金具：因覆冰和低温收缩承受额外机械应力，可能断裂。",
        "开关/配变：操作机构因低温卡涩拒动；绝缘子覆冰桥接导致闪络；变压器油位过低报警。",
    ],
    "大风": [
        "导线/电缆：风偏过大导致安全距离不足而放电；导线摆动不同步引发相间短路；异物悬挂。",
        "杆塔：风荷载超限导致倾斜或倒塌；塔材及附属设施损坏。",
        "金具：高频摆动加速金属疲劳，导致裂纹或断裂。",
        "开关/配变：控制线缆被异物短路导致误动；机构箱门被吹开进水；漂浮物造成短路。",
    ],
    "高温": [
        "导线/电缆：弧垂增大导致对地距离不足；接头和线夹因电阻增大而过热烧毁；实际载流量下降。",
        "金具：连接点发热问题加剧，可能烧毁。",
        "开关设备：内部发热增加，载流能力下降，可能触发过热报警；加速绝缘老化。",
        "配变：制冷负荷剧增导致过载运行，油温过高，绝缘加速老化，缩短寿命。",
    ],
    "雷电": [
        "导线/电缆：直接雷击或感应过电压导致绝缘子闪络，断路器跳闸；雷电流可能烧蚀导线。",
        "杆塔：雷直击塔顶时雷电流泄放可能引起反击闪络。",
        "开关设备：雷电波侵入威胁绝缘强度，可能引发内部闪络或爆炸；控制回路受电磁脉冲干扰。",
        "配变：雷电过电压侵入绕组造成绝缘击穿烧毁；避雷器失效时风险极高。",
    ],
    "阴雨": [
        "导线/电缆：​ 绝缘子表面污秽受潮，绝缘强度骤降，引发污闪接地或相间短路；电晕放电加剧，产生电噪声并腐蚀金具。",
        "杆塔：​ 基础周边土壤受潮松软，可能导致杆塔倾斜、沉降或滑坡；接地装置可能因腐蚀或干燥而电阻升高。",
        "开关设备：​ 机构箱/控制箱密封不严易受潮，导致二次回路短路、元器件锈蚀或控制失灵；设备外绝缘表面易发生污闪。",
        "配变：​ 高压套管污秽受潮引发闪络；呼吸器硅胶饱和失效导致潮气进入，使绝缘油受潮劣化；箱体渗漏雨直接危及内部绝缘。",
    ]
}

__all__ = [
    "PSR_TYPE_TO_DEVICE_TYPE",
    "DEVICE_AFFILIATED_MAP", 
    "DEVICE_AFFILIATED_FIELD_MAP",
    "RISK_RATIO_LOW",
    "RISK_RATIO_MEDIUM",
    "CONDUCTOR_CODE",
    "CONDUCTOR_CODES",
    "CABLE_CODE",
    "TOWER_CODE",
    "HARDWARE_CODE",
    "HARDWARE_CODES",
    "SWITCH_CODE",
    "SWITCH_CODES",
    "TRANSFORMER_CODE",
    "BILEIQI_CODE",
    "STATION_CODE",
    "WEATHER_FAULT_RISKS",
]

